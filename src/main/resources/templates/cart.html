<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{layout/layout :: head}">
</head>
<link rel="stylesheet" th:href="@{/assets/css/cart.css}">
<body>
<header th:replace="~{layout/layout :: header}">
</header>
<!-- Contenedor del contenido que limita el ancho -->
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 cart">
            <div class="title">
                <div class="row">
                    <div class="col"><h4><b>Carro de la compra</b></h4></div>
                </div>
            </div>
            <!-- La tabla de elementos del carrito se mostrará aquí -->
            <table id="cartTable" class="table">
                <thead>
                <tr>
                    <th>Producto</th>
                    <th>Nombre</th>
                    <th>Cantidad</th>
                    <th>Precio unitario</th>
                    <th>Total</th>
                    <th>Accion</th>
                </tr>
                </thead>
                <tbody>
                <!-- Los elementos del carrito se insertarán aquí mediante JavaScript -->
                </tbody>
            </table>
            <div class="back-to-shop"><a class="fas fa-arrow-alt-circle-left" th:href="@{/tienda}"><i></i>Volver a la tienda</a></div>
        </div>
        <!-- Inicio del resumen -->
        <div class="col-md-4 summary">
            <div><h5><b>Summary</b></h5></div>
            <hr>
            <form>
                <p>ENVÍO</p>
                <select id="shippingOption">
                    <option value="0.00" class="text-muted">Entrega estándar - 0.00&euro;</option>
                    <option value="15.00" class="text-muted">Entrega urgente - 15.00&euro;</option>
                </select>
                <p>DAR CÓDIGO</p>
                <input id="code" placeholder="Enter your code">
            </form>

            <div class="row" style="border-top: 1px solid rgba(0,0,0,.1); padding: 2vh 0;">
                <div class="col">PRECIO TOTAL</div>
                <!-- El precio total se actualizará dinámicamente con JavaScript -->
                <p class="col text-right" id="totalPrice"></p>
            </div>
            <form action="#" class="credit-card-div">
                <div class="panel panel-default" >
                    <div class="panel-heading">
                        <!-- Resto del formulario de resumen -->
                    </div>
                </div>
            </form>
            <button class="btn" onclick="sendCartDataToBackend()"> PAGAR </button>
        </div>
        <!-- Fin del resumen -->
    </div>
</div>
<!-- Fin del contenedor -->
<!-- Start Footer -->
<footer th:replace="~{layout/layout :: footer}">
</footer>
<!-- End Footer -->

<!-- Start Script -->
<script th:src="@{/assets/js/jquery-1.11.0.min.js}"></script>
<script th:src="@{/assets/js/jquery-migrate-1.2.1.min.js}"></script>
<script th:src="@{/assets/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/assets/js/templatemo.js}"></script>
<script th:src="@{/assets/js/custom.js}"></script>
<!-- Asegúrate de incluir cartService.js antes de este script -->
<script src="/assets/js/cartService.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script>
    // Función para calcular y actualizar el precio total incluyendo el costo de envío
    function updateTotalPrice() {
        // Obtener el costo de envío seleccionado por el usuario
        const shippingOption = document.getElementById('shippingOption');
        const shippingCost = parseFloat(shippingOption.value);

        // Obtener el precio total de los productos en el carrito
        const totalCartPrice = calculateTotalCart();

        // Calcular el nuevo precio total sumando el costo de envío al precio total de los productos en el carrito
        const newTotalPrice = totalCartPrice + shippingCost;

        // Actualizar el precio total en la interfaz de usuario
        document.getElementById('totalPrice').textContent = newTotalPrice.toFixed(2);
    }

    // Agregar un evento de cambio al elemento select para actualizar el precio total cuando se seleccione una opción de envío
    document.getElementById('shippingOption').addEventListener('change', updateTotalPrice);

    // Función para calcular el precio total de los productos en el carrito
    function calculateTotalCart() {
        // Recuperar el carrito del localStorage
        const storedCart = JSON.parse(localStorage.getItem('cart'));
        let total = 0;

        // Verificar si hay un carrito almacenado
        if (storedCart && storedCart.carItems) {
            // Iterar sobre los elementos del carrito
            for (const item of storedCart.carItems) {
                // Multiplicar el precio por la cantidad y sumar al total
                total += item.price * item.quantity;
            }
        }

        // Retornar el total del carrito
        return total;
    }

    // Llamada inicial para calcular el precio total
    updateTotalPrice();
</script>


<!-- Luego, en tu script HTML, puedes acceder a los datos del carrito y mostrarlos en la vista -->
<!-- End Script -->
<!-- Your custom scripts -->
<!-- End Slider Script -->
</body>
</html>
